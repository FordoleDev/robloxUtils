local Aimbot = {}

local plrs = game:GetService("Players")
local lplr = plrs.LocalPlayer
local cam = workspace.CurrentCamera
local uis = game:GetService("UserInputService")
local runs = game:GetService("RunService")

local aiming = false
local aimKeyCode = Enum.KeyCode.F

_G.Enabled = false
_G.FOV = 30
_G.ShowFOV = false
_G.AimPart = {"Head"}
_G.Aiming = false

function getClosestPlayer()
    if not lplr.Character then return nil end
    
    local hum = lplr.Character:FindFirstChild("HumanoidRootPart")
    if not hum then return nil end
    
    local closestPlayer = nil
    local closestDist = math.huge
    local mousePos = uis:GetMouseLocation()

    for _, plr in pairs(plrs:GetPlayers()) do
        if plr ~= lplr and plr.Character then
            if true then
                local aimPart = plr.Character:FindFirstChild(_G.AimPart[1] or "Head")
                
                if aimPart then
                    local screenPoint = cam:WorldToViewportPoint(aimPart.Position)
                    
                    if screenPoint.Z > 0 then
                        local screenPos = Vector2.new(screenPoint.X, screenPoint.Y)
                        local distance = (screenPos - mousePos).Magnitude
                        
                        if distance <= _G.FOV and distance < closestDist then
                            closestPlayer = plr
                            closestDist = distance
                        end
                    end
                end
            end
        end
    end
    
    return closestPlayer
end

uis.InputBegan:Connect(function(input)
    if input.KeyCode == aimKeyCode then
        aiming = true
    end
end)

uis.InputEnded:Connect(function(input)
    if input.KeyCode == aimKeyCode then
        aiming = false
    end
end)

runs.RenderStepped:Connect(function()
    if _G.Enabled and aiming and lplr.Character then
        local closestPlayer = getClosestPlayer()
        
        if closestPlayer then
            local aimPart = closestPlayer.Character:FindFirstChild(_G.AimPart[1] or "Head")
            if aimPart then
                cam.CFrame = CFrame.new(cam.CFrame.Position, aimPart.Position)
            end
        end
    end
end)

return Aimbot
